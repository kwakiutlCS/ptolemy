$(function() {

    //SPECIFIC CODE
    
    
    

    $("#pendulum_mass_slider").slider({ min: 0.050, max: 0.300, step: 0.001, value: 0.2 });
    $("#pendulum_length_slider").slider({ min: 0.10, max: 1.8, step: 0.02, value: 1 });
    $("#pendulum_angle_slider").slider({ min: 0.2, max: 30, value: 5, step: 0.1 });
    

    // creates initial parameters
    $(".data-gathering").on("click", "#pendulum1_data-gathering_next", function() {
	chart_vars.data_loaded = false;
	$(".data-gathering").slideUp();
	$(".model-choice").slideDown();
	
	chart_vars.linear_m = !chart_vars.linear_m  ? 1 : chart_vars.linear_m;
	chart_vars.linear_b = !chart_vars.linear_b  ? 0 : chart_vars.linear_b;
	chart_vars.quadratic_k = !chart_vars.quadratic_k ? 1 : chart_vars.quadratic_k;
	chart_vars.quadratic_h= !chart_vars.quadratic_h  ? 0 : chart_vars.quadratic_h;
	chart_vars.quadratic_b = !chart_vars.quadratic_b ? 0 : chart_vars.quadratic_b;
	chart_vars.root_k = !chart_vars.root_k ? 1 : chart_vars.root_k;
	chart_vars.root_h = !chart_vars.root_h ? 0 : chart_vars.root_h;
	chart_vars.root_b = !chart_vars.root_b ? 0 : chart_vars.root_b; 
	chart_vars.measurable = 1; 
	chart_vars.default_x = 1.8;
	chart_vars.x_maximum=chart_vars.default_x;
	$(".model_second_model_controls").remove();
	$(".model_first_model_controls").show();
	$(".model_function_controls").hide();
	$(".model-choice_buttons_explanation").show();
	$(".model_choice_model_information_div").hide();
	chart_vars.loadsPlot(chart_vars.plot_normal);
    

	$(".model_linear_m").html(chart_vars.linear_m);
	$(".model_linear_b").html(chart_vars.linear_b);
	$(".model_quadratic_k").html(chart_vars.quadratic_k);
	$(".model_quadratic_h").html(chart_vars.quadratic_h);
	$(".model_quadratic_b").html(chart_vars.quadratic_b);
	$(".model_root_k").html(chart_vars.root_k);
	$(".model_root_h").html(chart_vars.root_h);
	$(".model_root_b").html(chart_vars.root_b);
	

    
	// slider limits
	
	$("#pendulum1_linear_m_slider").slider({value: 1, min: 0, max: 10, step: 0.05});
	$("#pendulum1_linear_b_slider").slider({ min: -2.5, max: 2.5, step: 0.01});
	$("#pendulum1_quadratic_k_slider").slider({value: 1, min: 0, max: 10, step: 0.05});
	$("#pendulum1_quadratic_h_slider").slider({value: 0, min: 0, max: chart_vars.default_x, step: 0.01});
	$("#pendulum1_quadratic_b_slider").slider({value: 0, min: -2.5, max: 2.5, step: 0.01});
	$("#pendulum1_root_k_slider").slider({value: 1, min: 0, max: 10, step: 0.05});
	$("#pendulum1_root_h_slider").slider({value: 0, min: 0, max: chart_vars.default_x, step: 0.01});
	$("#pendulum1_root_b_slider").slider({value: 0, min: -2.5, max: 2.5, step: 0.01});
	




	chart_vars.animatePlot = function() {
	 
	    if (chart_vars.model === 1) {
		if (chart_vars.animation_phase === 1)
		    chart_vars.x_maximum *= 1.05;
		else
		    chart_vars.y_maximum *= 1.05;
		
		chart_vars.plot_linear(chart_vars.x_maximum, chart_vars.y_maximum);
	    }
	    else if (chart_vars.model === 2) {
		if (chart_vars.animation_phase === 1)
		    chart_vars.x_maximum *= 1.05;
		else
		    chart_vars.y_maximum *= Math.pow(1.05,2);
		var quadratic_data = chart_vars.getQuadraticData();
		chart_vars.plot_polynomial(quadratic_data, chart_vars.x_maximum, chart_vars.y_maximum);
	    }
	    else if (chart_vars.model === 3) {
		if (chart_vars.animation_phase === 1)
		    chart_vars.x_maximum *= 1.05;
		else
		    chart_vars.y_maximum *= Math.pow(1.05,3);
		var root_data = chart_vars.getRootData();
		chart_vars.plot_polynomial(root_data, chart_vars.x_maximum, chart_vars.y_maximum);
	    }
 	    
	    if (chart_vars.animation_phase === 1 && chart_vars.x_maximum > chart_vars.measurable/9*10) {
		chart_vars.animation_phase = 2;
	    }
	    else if (chart_vars.animation_phase === 2 && chart_vars.y_maximum > chart_vars.prediction/9*10) {
		clearInterval(chart_vars.intervalId);
		chart_vars.intervalId = false;
		chart_vars.animation_phase = false;
		$(".model_slider_controls").slider({disabled:false});
		chart_vars.x_maximum = chart_vars.default_x;
		chart_vars.y_maximum = chart_vars.setYMax();
	     
		$(".model_choice_buttons").append("<div class='model_second_model_controls'><p><%= I18n.translate("pendulum1.prediction1") %>"+chart_vars.scientific(chart_vars.prediction,1)+"<%= I18n.translate("pendulum1.prediction2") %>"+chart_vars.scientific(chart_vars.measurable,1)+"<%= I18n.translate("pendulum1.prediction3") %></p><p> <%= I18n.translate("pendulum1.prediction4") %> </p><p><%= I18n.translate("pendulum1.prediction5") %>"+(chart_vars.prediction/3600000*0.1).toFixed(2)+"€.</p><p><a href='#' class='model_another_model_link'>Experimentar outro modelo</a> ou <a href='#' class='model_keep_model_link'>Continuar com este modelo</a></p></div>");
		$(".model_first_model_controls").hide();
		
		$(".model_another_model_link").on("click", function() {
		    $(".model_second_model_controls").remove();
		    $(".model_function_controls").hide();
		    $(".model_choice_model_information_div").hide();
		    $(".model_first_model_controls").show();
		    chart_vars.model = 1;
		    chart_vars.loadsPlot(chart_vars.plot_normal);
		});

		$(".model_keep_model_link").on("click", function() {
		    $(".model-choice").slideUp();
		    $(".questions").slideDown();
		    
		    
		    var m;
		    if (chart_vars.model === 1) {
			if (chart_vars.linear_m)
			    m = "linear";
			else 
			 m = "constante";
		    }
		    else if (chart_vars.model === 2) {
			if (chart_vars.quadratic_k)
			    m = "quadrático";
			else
			    m = "constante";
		    }
		    else if (chart_vars.model === 3) {
			if (chart_vars.root_k)
			 m = "cúbico";
			else
			    m = "constante";
		    }
		    
		    var question1, question2,question3,question4;
		    question1 = "<%= I18n.translate("modeling.choice1") %><b>"+m+"</b><%= I18n.translate("modeling.choice2") %>";

		  
		    question2 = "A previsão de "+chart_vars.scientific(chart_vars.prediction)+"J, que corresponde a um custo de "+(chart_vars.prediction/3600000*0.1).toFixed(2)+"€, parece-lhe razoável?";
		  

		    question3 = "Há algum factor que não foi considerado que afete esta previsão? Qual? Esse fator implicará um acréscimo ou decréscimo de energia gasta para aquecer a água?";
		  
		    question4 = "<%= I18n.translate("modeling.opinion") %>";

		    
		  $(".question_model_field").val(m);
		  $(".question_question1_label").html(question1);
		  $(".question_question1_field").val(question1);

		  
		  $(".question_question2_label").html(question2);
		  $(".question_question2_field").val(question2);

		  $(".question_question3_label").html(question3);
		  $(".question_question3_field").val(question3);
		  
		  $(".question_question4_label").html(question4);
		  $(".question_question4_field").val(question4);

		 
	     });
	     
	 }
	}





    });



    
    
});
